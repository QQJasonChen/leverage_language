<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基本分析測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .result {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>🔧 基本分析測試</h1>
    <p>這個頁面測試不依賴AI的基本句型分析功能</p>

    <div class="test-container">
        <h3>測試句子: "Het feestje is gezellig"</h3>
        <button onclick="testBasicAnalysis()">🔍 測試基本分析</button>
        <button onclick="testSuggestions()">📚 測試詞彙建議</button>
        <button onclick="testEvaluation()">✅ 測試評估</button>
    </div>

    <div id="results"></div>

    <script src="lib/imitation-practice-manager.js"></script>
    <script>
        // Mock Chrome APIs for testing
        if (typeof chrome === 'undefined') {
            window.chrome = {
                runtime: {
                    sendMessage: async (message) => {
                        console.log('Mock chrome.runtime.sendMessage:', message);
                        // Always simulate AI failure to test fallbacks
                        return { success: false, error: 'AI not configured (mock)' };
                    }
                }
            };
        }

        const manager = new ImitationPracticeManager();
        const testSentence = {
            text: "Het feestje is gezellig",
            language: "dutch",
            source: "test"
        };

        async function testBasicAnalysis() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<div class="result"><h4>🔍 基本句型分析測試</h4><p>分析中...</p></div>`;
            
            try {
                const pattern = await manager.generateAIPattern(testSentence);
                console.log('Pattern result:', pattern);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>✅ 分析結果</h4>
                        <p><strong>句型模板:</strong> ${pattern.template}</p>
                        <p><strong>語法要點:</strong> ${pattern.grammarPoints.join(', ')}</p>
                        <p><strong>語言:</strong> ${pattern.language}</p>
                        <p><strong>難度:</strong> ${pattern.complexity}</p>
                        <pre>${JSON.stringify(pattern, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>❌ 分析失敗</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        async function testSuggestions() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<div class="result"><h4>📚 詞彙建議測試</h4><p>生成中...</p></div>`;
            
            try {
                const pattern = { template: '[冠詞] [名詞] [動詞] [形容詞]', language: 'dutch' };
                const suggestions = await manager.generateReplacementSuggestions(testSentence, pattern);
                console.log('Suggestions result:', suggestions);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>✅ 詞彙建議結果</h4>
                        ${suggestions.map(s => `
                            <p><strong>${s.original}</strong> (${s.type}): ${s.alternatives.join(', ')}</p>
                        `).join('')}
                        <pre>${JSON.stringify(suggestions, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>❌ 建議失敗</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        async function testEvaluation() {
            const resultsDiv = document.getElementById('results');
            const userInput = "De vergadering is interessant";
            const pattern = { template: '[冠詞] [名詞] [動詞] [形容詞]', language: 'dutch' };
            
            resultsDiv.innerHTML += `<div class="result"><h4>✅ 評估測試</h4><p>評估句子: "${userInput}"</p></div>`;
            
            try {
                const evaluation = await manager.evaluateWithAI(userInput, testSentence, pattern);
                console.log('Evaluation result:', evaluation);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>✅ 評估結果</h4>
                        <p><strong>得分:</strong> ${evaluation.score}/100</p>
                        <p><strong>反饋:</strong> ${evaluation.feedback}</p>
                        <p><strong>優點:</strong> ${evaluation.strengths.join(', ')}</p>
                        <p><strong>建議:</strong> ${evaluation.suggestions.join(', ')}</p>
                        <pre>${JSON.stringify(evaluation, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>❌ 評估失敗</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        console.log('🔧 Basic analysis test page loaded');
        console.log('Manager:', manager);
    </script>
</body>
</html>