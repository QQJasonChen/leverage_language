<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºæœ¬åˆ†ææ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .result {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ åŸºæœ¬åˆ†ææ¸¬è©¦</h1>
    <p>é€™å€‹é é¢æ¸¬è©¦ä¸ä¾è³´AIçš„åŸºæœ¬å¥å‹åˆ†æåŠŸèƒ½</p>

    <div class="test-container">
        <h3>æ¸¬è©¦å¥å­: "Het feestje is gezellig"</h3>
        <button onclick="testBasicAnalysis()">ğŸ” æ¸¬è©¦åŸºæœ¬åˆ†æ</button>
        <button onclick="testSuggestions()">ğŸ“š æ¸¬è©¦è©å½™å»ºè­°</button>
        <button onclick="testEvaluation()">âœ… æ¸¬è©¦è©•ä¼°</button>
    </div>

    <div id="results"></div>

    <script src="lib/imitation-practice-manager.js"></script>
    <script>
        // Mock Chrome APIs for testing
        if (typeof chrome === 'undefined') {
            window.chrome = {
                runtime: {
                    sendMessage: async (message) => {
                        console.log('Mock chrome.runtime.sendMessage:', message);
                        // Always simulate AI failure to test fallbacks
                        return { success: false, error: 'AI not configured (mock)' };
                    }
                }
            };
        }

        const manager = new ImitationPracticeManager();
        const testSentence = {
            text: "Het feestje is gezellig",
            language: "dutch",
            source: "test"
        };

        async function testBasicAnalysis() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<div class="result"><h4>ğŸ” åŸºæœ¬å¥å‹åˆ†ææ¸¬è©¦</h4><p>åˆ†æä¸­...</p></div>`;
            
            try {
                const pattern = await manager.generateAIPattern(testSentence);
                console.log('Pattern result:', pattern);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âœ… åˆ†æçµæœ</h4>
                        <p><strong>å¥å‹æ¨¡æ¿:</strong> ${pattern.template}</p>
                        <p><strong>èªæ³•è¦é»:</strong> ${pattern.grammarPoints.join(', ')}</p>
                        <p><strong>èªè¨€:</strong> ${pattern.language}</p>
                        <p><strong>é›£åº¦:</strong> ${pattern.complexity}</p>
                        <pre>${JSON.stringify(pattern, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âŒ åˆ†æå¤±æ•—</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        async function testSuggestions() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += `<div class="result"><h4>ğŸ“š è©å½™å»ºè­°æ¸¬è©¦</h4><p>ç”Ÿæˆä¸­...</p></div>`;
            
            try {
                const pattern = { template: '[å† è©] [åè©] [å‹•è©] [å½¢å®¹è©]', language: 'dutch' };
                const suggestions = await manager.generateReplacementSuggestions(testSentence, pattern);
                console.log('Suggestions result:', suggestions);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âœ… è©å½™å»ºè­°çµæœ</h4>
                        ${suggestions.map(s => `
                            <p><strong>${s.original}</strong> (${s.type}): ${s.alternatives.join(', ')}</p>
                        `).join('')}
                        <pre>${JSON.stringify(suggestions, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âŒ å»ºè­°å¤±æ•—</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        async function testEvaluation() {
            const resultsDiv = document.getElementById('results');
            const userInput = "De vergadering is interessant";
            const pattern = { template: '[å† è©] [åè©] [å‹•è©] [å½¢å®¹è©]', language: 'dutch' };
            
            resultsDiv.innerHTML += `<div class="result"><h4>âœ… è©•ä¼°æ¸¬è©¦</h4><p>è©•ä¼°å¥å­: "${userInput}"</p></div>`;
            
            try {
                const evaluation = await manager.evaluateWithAI(userInput, testSentence, pattern);
                console.log('Evaluation result:', evaluation);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âœ… è©•ä¼°çµæœ</h4>
                        <p><strong>å¾—åˆ†:</strong> ${evaluation.score}/100</p>
                        <p><strong>åé¥‹:</strong> ${evaluation.feedback}</p>
                        <p><strong>å„ªé»:</strong> ${evaluation.strengths.join(', ')}</p>
                        <p><strong>å»ºè­°:</strong> ${evaluation.suggestions.join(', ')}</p>
                        <pre>${JSON.stringify(evaluation, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>âŒ è©•ä¼°å¤±æ•—</h4>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        console.log('ğŸ”§ Basic analysis test page loaded');
        console.log('Manager:', manager);
    </script>
</body>
</html>